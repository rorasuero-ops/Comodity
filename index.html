<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC7QcScbqc5dWL4WCatnemf_KGCaZtjCT4",
      authDomain: "comodity-9a7be.firebaseapp.com",
      projectId: "comodity-9a7be",
      storageBucket: "comodity-9a7be.firebasestorage.app",
      messagingSenderId: "560121634288",
      appId: "1:560121634288:web:e02bdad21bd4ee06255135",
      measurementId: "G-PYNZCB10T0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comodity</title>

  <style>
    :root {
      --primary: #f44336;
      --accent: #c62828;
      --bg: #f5f5f5;
      --card-bg: #ffffff;
      --text-main: #111;
      --text-soft: #555;
    }

    * { box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text-main);
    }

    /* LOGIN */

    #login-screen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #ff8a80, #b71c1c);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 1000;
    }

    .login-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 22px 20px 18px;
      width: 100%;
      max-width: 360px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
      text-align: center;
    }

    .login-logo-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 54px;
      height: 54px;
      background: #fff3e0;
      color: #000;
      font-size: 24px;
      font-weight: bold;
      clip-path: polygon(15% 0%, 90% 10%, 100% 60%, 55% 100%, 0% 65%);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .login-title { font-size: 20px; font-weight: bold; margin-top: 8px; }

    .login-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      margin: 4px 0 12px;
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      text-align: left;
    }

    .login-form label {
      font-size: 12px;
      color: var(--text-soft);
    }

    .login-form input {
      width: 100%;
      padding: 8px 9px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    .login-button {
      margin-top: 6px;
      width: 100%;
      padding: 9px 12px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
    }

    .login-button.google {
      margin-top: 10px;
      background: #4285f4;
    }

    .login-note {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-soft);
      text-align: left;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }

    .link-like {
      border: none;
      background: none;
      padding: 0;
      margin: 0;
      font-size: 11px;
      color: #ffffff;
      cursor: pointer;
      text-decoration: underline;
    }

    /* APP PRINCIPAL */

    #app { display: none; }

    header {
      background: var(--primary);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      color: #fff;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .user-avatar {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #fff;
      color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      overflow: hidden;
      background-size: cover;
      background-position: center;
    }

    .user-text { display: flex; flex-direction: column; gap: 3px; }

    .user-name {
      font-weight: bold;
      font-size: 14px;
      white-space: nowrap;
    }

    .user-balances {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 12px;
    }

    .badge-balance {
      background: rgba(255,255,255,0.16);
      border-radius: 999px;
      padding: 2px 8px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .badge-balance strong { font-weight: 700; }

    .badge-balance .label {
      font-size: 11px;
      text-transform: uppercase;
    }

    .badge-coupons {
      cursor: pointer;
      border: 1px dashed rgba(255,255,255,0.7);
    }

    .badge-lightning {
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.6);
    }

    .admin-link {
      padding: 6px 12px;
      border-radius: 999px;
      background: #ffffff;
      color: #f44336;
      font-size: 12px;
      font-weight: 600;
      text-decoration: none;
      border: none;
      cursor: pointer;
    }

    .admin-link:hover { background: #ffe3df; }

    .logo-big {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 42px;
      height: 42px;
      background: #fff;
      color: #000;
      font-size: 22px;
      font-weight: bold;
      clip-path: polygon(15% 0%, 90% 10%, 100% 60%, 55% 100%, 0% 65%);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .title-text {
      font-size: 18px;
      font-weight: bold;
      white-space: nowrap;
    }

    /* Men√∫ usuario */

    .user-menu {
      position: fixed;
      top: 56px;
      left: 16px;
      background: #ffffff;
      color: #333;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      padding: 6px 0;
      display: none;
      z-index: 1100;
      min-width: 180px;
      font-size: 14px;
    }

    .user-menu-item {
      padding: 8px 14px;
      cursor: pointer;
    }

    .user-menu-item:hover { background: #f5f5f5; }

    main { padding-bottom: 24px; }

    .screen { display: none; }
    .screen.active { display: block; }

    /* HOME TOP */

    .home-top {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.3fr) minmax(0, 1.2fr);
      gap: 14px;
      margin: 16px 16px 8px;
    }

    .home-column {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .home-card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      padding: 12px 14px;
    }

    .home-card-title {
      font-size: 16px;
      font-weight: 800;
      margin: 0 0 6px;
      color: #222;
    }

    .home-card-title span { color: var(--primary); }

    .home-card-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .raffle-main {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .raffle-text-block { flex: 1; }

    .raffle-tv-img {
      flex: 0 0 50%;
      max-width: 50%;
      border-radius: 12px;
      object-fit: cover;
      height: 140px;
    }

    .raffle-date {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 3px;
    }

    /* RULETA */

    .ruleta-container {
      background: var(--card-bg);
      padding: 16px 16px 18px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    .ruleta-title {
      font-size: 17px;
      margin-top: 0;
      margin-bottom: 10px;
      color: var(--text-soft);
      text-align: center;
      font-weight: 600;
    }

    .ruleta-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      margin-top: 3px;
    }

    .ruleta {
      width: 250px;
      height: 250px;
      border-radius: 50%;
      position: relative;
      background:
        radial-gradient(circle at 30% 0%, rgba(255,255,255,0.35), transparent 55%),
        radial-gradient(circle at 50% 120%, rgba(255,215,0,0.35), transparent 60%),
        conic-gradient(
          #1b1b1b 0deg 45deg,
          #6d4c41 45deg 90deg,
          #1b1b1b 90deg 135deg,
          #6d4c41 135deg 180deg,
          #1b1b1b 180deg 225deg,
          #6d4c41 225deg 270deg,
          #1b1b1b 270deg 315deg,
          #6d4c41 315deg 360deg
        );
      box-shadow: 0 6px 16px rgba(0,0,0,0.4), 0 0 0 4px #000, 0 0 0 8px #fbc02d;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
    }

    .pointer {
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 26px solid #fdd835;
      position: absolute;
      top: -32px;
      left: 50%;
      transform: translateX(-50%);
      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.6));
    }

    .ruleta-center {
      width: 82px;
      height: 82px;
      border-radius: 50%;
      background: radial-gradient(circle, #fffde7 0%, #fbc02d 55%, #f57f17 100%);
      border: 3px solid #3e2723;
      box-shadow: 0 0 10px rgba(255,214,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-center {
      width: 54px;
      height: 54px;
      background: #ffffff;
      color: #000;
      font-size: 26px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      clip-path: polygon(15% 0%, 90% 10%, 100% 60%, 55% 100%, 0% 65%);
      box-shadow: 0 2px 5px rgba(0,0,0,0.4);
    }

    .ruleta-segment-icon {
      position: absolute;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.35);
    }

    .seg-1 { top: 10px; left: 50%; transform: translateX(-50%); }
    .seg-2 { top: 32px; right: 26px; }
    .seg-3 { top: 50%; right: 4px; transform: translateY(-50%); }
    .seg-4 { bottom: 32px; right: 26px; }
    .seg-5 { bottom: 10px; left: 50%; transform: translateX(-50%); }
    .seg-6 { bottom: 32px; left: 26px; }
    .seg-7 { top: 50%; left: 4px; transform: translateY(-50%); }
    .seg-8 { top: 32px; left: 26px; }

    .wheel-coin-yellow {
      background: radial-gradient(circle, #fff9c4 0%, #ffeb3b 55%, #fbc02d 100%);
      border: 2px solid #795548;
      color: #5d4037;
    }

    .wheel-coin-blue {
      background: radial-gradient(circle, #e3f2fd 0%, #64b5f6 55%, #1e88e5 100%);
      border: 2px solid #0d47a1;
      color: #0d47a1;
    }

    .wheel-percent {
      background: radial-gradient(circle, #f3e5f5 0%, #ba68c8 50%, #7b1fa2 100%);
      border: 2px solid #4a148c;
      color: #fff;
      font-size: 16px;
    }

    .btn-girar {
      background: var(--accent);
      color: #fff;
      padding: 12px 20px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      max-width: 260px;
      font-weight: bold;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      margin-top: 4px;
    }

    .btn-girar:disabled { opacity: 0.6; cursor: not-allowed; }

    #resultado {
      margin-top: 8px;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
    }

    .tiradas-info {
      margin-top: 8px;
      text-align: center;
      font-size: 14px;
      color: var(--text-soft);
    }

    .cooldown-info {
      margin-top: 4px;
      text-align: center;
      font-size: 13px;
      color: var(--accent);
      font-weight: bold;
    }

    /* CATEGOR√çAS */

    .categorias {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
      margin: 8px 16px 30px;
    }

    .categoria {
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      cursor: pointer;
      background: #e0e0e0;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }

    .categoria:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 14px rgba(0,0,0,0.2);
    }

    .cat-bottom {
      background: #3c3c3c;
      padding: 8px 10px;
      color: #fff;
      font-size: 13px;
      text-align: center;
    }

    /* OVERLAYS GENERALES */

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .popup {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 18px 20px 16px;
      max-width: 340px;
      width: calc(100% - 40px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      text-align: center;
      position: relative;
    }

    .popup-close {
      border: none;
      background: var(--accent);
      color: #fff;
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      margin-top: 6px;
    }

    /* PANTALLA CELULARES Y CATEGOR√çA FIRESTORE */

    .back-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 14px 20px 4px;
      font-size: 14px;
      color: var(--text-soft);
    }

    .back-link {
      background: none;
      border: none;
      color: var(--accent);
      font-weight: bold;
      cursor: pointer;
    }

    .cellphones-title {
      font-size: 18px;
      font-weight: bold;
      padding: 0 20px;
      margin-top: 0;
    }

    .cellphones-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      padding: 0 20px 10px;
    }

    .cellphones-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      padding: 0 16px 20px;
    }

    .cell-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      overflow: hidden;
      cursor: pointer;
      display: flex;
      flex-direction: column;
    }

    .cell-img-wrap {
      height: 160px;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cell-img-wrap img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .cell-body {
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }

    .cell-name {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 2px;
    }

    .cell-prices {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .cell-price-old {
      text-decoration: line-through;
      color: #888;
    }

    .cell-price-now {
      color: #2e7d32;
      font-weight: bold;
      font-size: 15px;
    }

    .cell-discount-pill {
      margin-top: 4px;
      background: #fff3e0;
      border-radius: 999px;
      padding: 3px 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #e65100;
    }

    .cell-timer {
      margin-top: 2px;
      font-size: 12px;
      color: var(--accent);
    }

    /* Popup detalle producto */

    .cell-detail-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 6px;
    }

    .cell-detail-img {
      max-width: 90%;
      max-height: 180px;
      object-fit: contain;
      margin-bottom: 10px;
    }

    .cell-detail-text {
      text-align: left;
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .cell-detail-text strong {
      color: var(--text-main);
    }

    /* RESPONSIVE */

    @media (max-width: 900px) {
      .home-top {
        grid-template-columns: 1fr;
      }
      .categorias {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="login-screen">
    <div class="login-card">
      <div class="login-logo">
        <div class="login-logo-icon">C</div>
      </div>
      <div class="login-title">Comodity</div>
      <div class="login-subtitle">
        Inici√° sesi√≥n para acceder a tus ruletas, premios y cupones.
      </div>

      <form id="login-form" class="login-form">
        <div>
          <label for="login-email">Email</label>
          <input id="login-email" type="email" placeholder="tucorreo@ejemplo.com" />
        </div>
        <div>
          <label for="login-pass">Contrase√±a</label>
          <input id="login-pass" type="password" placeholder="********" />
        </div>
        <button type="submit" class="login-button">Entrar</button>
      </form>

      <button id="google-btn" class="login-button google">
        Entrar con Google
      </button>

      <div class="login-note">
        <span>Solo para uso interno de pruebas.</span>
        <button class="link-like" id="skip-login">Saltar login</button>
      </div>
    </div>
  </div>

  <!-- APP PRINCIPAL -->
  <div id="app">
    <header>
      <div class="header-left">
        <div id="user-avatar" class="user-avatar">C</div>
        <div class="user-text">
          <div id="user-name" class="user-name">Usuario</div>
          <div class="user-balances">
            <div class="badge-balance">
              <span class="label">Libre</span>
              <span class="value" id="saldo-libre">$150</span>
            </div>
            <div class="badge-balance badge-lightning" id="open-lightning">
              <span class="label">Lightning</span>
              <span class="value" id="saldo-lightning">$80</span>
            </div>
            <div class="badge-balance badge-coupons" id="open-coupons">
              <span class="label">Cupones</span>
              <span class="value" id="cupones-count">2</span>
            </div>
          </div>
        </div>
      </div>

      <div class="header-right">
        <button class="admin-link" onclick="window.location.href='admin.html'">Admin</button>
      </div>
    </header>

    <!-- Men√∫ usuario -->
    <div id="user-menu" class="user-menu">
      <div class="user-menu-item" id="open-profile">Mis datos</div>
      <div class="user-menu-item" id="logout-btn">Cerrar sesi√≥n</div>
    </div>

    <main>
      <!-- HOME -->
      <div id="home-screen" class="screen active">
        <div class="home-top">
          <!-- Columna izquierda: sorteo TV -->
          <div class="home-column">
            <div class="home-card">
              <div class="home-card-title">
                Pr√≥ximo sorteo <span>Smart TV TCL 50"</span>
              </div>
              <div class="home-card-subtitle">
                Cada tirada en la ruleta suma chances para el sorteo.
              </div>
              <div class="raffle-main">
                <div class="raffle-text-block">
                  <p style="margin:0;font-size:13px;">
                    Particip√°s autom√°ticamente con tu usuario de Comodity.
                  </p>
                  <div class="raffle-date" id="raffle-date-text">
                    El sorteo es en 2 semanas üéÅ
                  </div>
                </div>
                <img src="img/tv.jpg" alt="Smart TV" class="raffle-tv-img">
              </div>
            </div>
          </div>

          <!-- Columna central: ruleta -->
          <div class="home-column">
            <div class="ruleta-container">
              <p class="ruleta-title">
                Gir√° la ruleta para ganar saldo Lightning, saldo libre, descuentos y cupones especiales.
              </p>
              <div class="ruleta-wrapper">
                <div class="ruleta" id="ruleta">
                  <div class="pointer"></div>
                  <div class="ruleta-center">
                    <div class="logo-center">C</div>
                  </div>

                  <div class="ruleta-segment-icon seg-1 wheel-coin-yellow">L</div>
                  <div class="ruleta-segment-icon seg-2 wheel-coin-blue">‚ö°</div>
                  <div class="ruleta-segment-icon seg-3 wheel-percent">-30%</div>
                  <div class="ruleta-segment-icon seg-4 wheel-coin-yellow">L</div>
                  <div class="ruleta-segment-icon seg-5 wheel-coin-blue">‚ö°</div>
                  <div class="ruleta-segment-icon seg-6 wheel-percent">-20%</div>
                  <div class="ruleta-segment-icon seg-7 wheel-coin-yellow">L</div>
                  <div class="ruleta-segment-icon seg-8 wheel-coin-blue">‚ö°</div>
                </div>

                <button id="btn-girar" class="btn-girar">Girar ruleta</button>
                <div id="resultado"></div>
                <div class="tiradas-info" id="tiradas-info"></div>
                <div class="cooldown-info" id="cooldown-info"></div>
              </div>
            </div>
          </div>

          <!-- Columna derecha: ofertas fijas (demo) -->
          <div class="home-column">
            <div class="home-card">
              <div class="home-card-title">Ofertas fugaces</div>
              <div class="home-card-subtitle">
                Ejemplos de ofertas que despu√©s vas a poder cargar desde el admin.
              </div>

              <div class="offers-list">
                <div class="offer-item">
                  <img src="img/pizza.jpg" class="offer-img" alt="Pizza">
                  <div class="offer-info">
                    <div class="offer-name">2x1 en PizzaRocket</div>
                    <div class="offer-prices">
                      <span class="old">$ 590</span>
                      <span class="now">$ 320</span>
                    </div>
                    <div class="offer-timer">Termina en 16 h</div>
                  </div>
                </div>

                <div class="offer-item">
                  <img src="img/zapas.jpg" class="offer-img" alt="Zapatillas">
                  <div class="offer-info">
                    <div class="offer-name">Zapatillas running</div>
                    <div class="offer-prices">
                      <span class="old">$ 2.100</span>
                      <span class="now">$ 899</span>
                    </div>
                    <div class="offer-timer">Termina en 30 h</div>
                  </div>
                </div>

                <div class="offer-item">
                  <img src="img/gym.jpg" class="offer-img" alt="Gym">
                  <div class="offer-info">
                    <div class="offer-name">Membres√≠a Fiter 3 meses</div>
                    <div class="offer-prices">
                      <span class="old">$ 5.700</span>
                      <span class="now">$ 3.870</span>
                    </div>
                    <div class="offer-timer">Termina en 70 h</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CATEGOR√çAS -->
        <div class="categorias">
          <div class="categoria" data-cat="muebles">
            <div class="cat-bottom">Muebles y hogar</div>
          </div>
          <div class="categoria" data-cat="deportes">
            <div class="cat-bottom">Deportes y fitness</div>
          </div>
          <div class="categoria" data-cat="comida">
            <div class="cat-bottom">Comida</div>
          </div>
          <div class="categoria" data-cat="electro">
            <div class="cat-bottom">Electrodom√©sticos</div>
          </div>
        </div>
      </div>

      <!-- PANTALLA CELULARES (DEMO) -->
      <div id="cellphones-screen" class="screen">
        <div class="back-bar">
          <button class="back-link" onclick="goToHome()">‚Üê Volver</button>
        </div>
        <div class="cellphones-title">Celulares en oferta</div>
        <div class="cellphones-subtitle">
          Ejemplo de pantalla fija de celulares. M√°s adelante tambi√©n puede venir de Firestore.
        </div>
        <div class="cellphones-grid" id="cellphones-grid"></div>
      </div>

      <!-- PANTALLA GEN√âRICA DE CATEGOR√çA (FIRESTORE) -->
      <div id="category-screen" class="screen">
        <div class="back-bar">
          <button class="back-link" onclick="goToHome()">‚Üê Volver</button>
        </div>
        <div id="category-title" class="cellphones-title"></div>
        <div id="category-subtitle" class="cellphones-subtitle"></div>
        <div id="category-grid" class="cellphones-grid"></div>
      </div>

      <!-- PANTALLA REFERIDOS / DEMO -->
      <div id="referrals-screen" class="screen">
        <div class="back-bar">
          <button class="back-link" onclick="goToHome()">‚Üê Volver</button>
        </div>
        <div class="cellphones-title">Invit√° amigos</div>
        <div class="cellphones-subtitle">
          M√°s adelante ac√° podemos armar todo el flujo de referidos.
        </div>
      </div>
    </main>
  </div>

  <!-- Popup detalle producto / celular -->
  <div id="cell-detail-overlay" class="overlay">
    <div class="popup" style="max-width:380px;">
      <h3 id="cell-detail-title" class="cell-detail-title"></h3>
      <img id="cell-detail-img" class="cell-detail-img" src="" alt="">
      <div id="cell-detail-prices" class="cell-detail-text"></div>
      <div id="cell-detail-extra" class="cell-detail-text"></div>
      <button class="popup-close" onclick="closeCellDetail()">Cerrar</button>
    </div>
  </div>

  <!-- Popup cupones -->
  <div id="coupons-overlay" class="overlay">
    <div class="popup">
      <div class="popup-title">Cupones disponibles</div>
      <div class="popup-subtitle">Ejemplo de listado de cupones del usuario.</div>
      <div id="coupons-list" class="coupons-list">
        <!-- se llena por JS -->
      </div>
      <button class="popup-close" onclick="closeCoupons()">Cerrar</button>
    </div>
  </div>

  <!-- Popup lightning (solo texto por ahora) -->
  <div id="lightning-overlay" class="overlay">
    <div class="popup">
      <div class="popup-title">Saldo Lightning</div>
      <div class="popup-subtitle">
        Ac√° despu√©s pod√©s explicar mejor c√≥mo se usa el saldo Lightning.
      </div>
      <p style="font-size:13px;color:#555;">
        Por ahora solo es demostrativo.
      </p>
      <button class="popup-close" onclick="closeLightning()">Cerrar</button>
    </div>
  </div>

  <!-- Popup perfil -->
  <div id="profile-overlay" class="overlay">
    <div class="popup">
      <div class="popup-title">Mis datos</div>
      <div class="popup-subtitle">
        M√°s adelante se puede guardar en Firestore / Realtime DB.
      </div>
      <div class="profile-form">
        <label>Nombre completo
          <input type="text" id="profile-name" />
        </label>
        <label>Tel√©fono
          <input type="tel" id="profile-phone" />
        </label>
      </div>
      <button class="popup-close" onclick="closeProfile()">Cerrar</button>
    </div>
  </div>

  <script>
    // Utilidades de pantallas
    function showScreen(id) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function goToHome() {
      showScreen("home-screen");
    }

    function goToCellphones() {
      showScreen("cellphones-screen");
    }

    // LOGIN

    const loginScreen  = document.getElementById("login-screen");
    const appRoot      = document.getElementById("app");
    const loginForm    = document.getElementById("login-form");
    const googleBtn    = document.getElementById("google-btn");
    const skipLoginBtn = document.getElementById("skip-login");

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value.trim();
      const pass  = document.getElementById("login-pass").value.trim();
      if (!email || !pass) {
        alert("Complet√° email y contrase√±a.");
        return;
      }
      try {
        await auth.signInWithEmailAndPassword(email, pass);
      } catch (err) {
        console.error(err);
        alert("Error de login: " + err.message);
      }
    });

    googleBtn.addEventListener("click", async () => {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
      } catch (err) {
        console.error(err);
        alert("Error con Google: " + err.message);
      }
    });

    skipLoginBtn.addEventListener("click", () => {
      loginScreen.style.display = "none";
      appRoot.style.display = "block";
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        loginScreen.style.display = "none";
        appRoot.style.display     = "block";
        document.getElementById("user-name").textContent = user.displayName || user.email || "Usuario";
        document.getElementById("user-avatar").textContent = (user.displayName || user.email || "U")[0].toUpperCase();
      } else {
        // si no hay usuario, dejamos visible el login
        loginScreen.style.display = "flex";
        appRoot.style.display     = "none";
      }
    });

    // Men√∫ usuario
    const userAvatarEl = document.getElementById("user-avatar");
    const userMenuEl   = document.getElementById("user-menu");
    const logoutBtn    = document.getElementById("logout-btn");
    const openProfileBtn = document.getElementById("open-profile");

    userAvatarEl.addEventListener("click", () => {
      userMenuEl.style.display = (userMenuEl.style.display === "block") ? "none" : "block";
    });

    document.addEventListener("click", (e) => {
      if (!userMenuEl.contains(e.target) && e.target !== userAvatarEl) {
        userMenuEl.style.display = "none";
      }
    });

    logoutBtn.addEventListener("click", async () => {
      try {
        await auth.signOut();
      } catch (err) {
        console.error(err);
      }
    });

    // RULETA (versi√≥n simplificada, misma idea que antes)

    const btnGirarEl     = document.getElementById("btn-girar");
    const ruletaEl       = document.getElementById("ruleta");
    const resultadoEl    = document.getElementById("resultado");
    const tiradasInfoEl  = document.getElementById("tiradas-info");
    const cooldownInfoEl = document.getElementById("cooldown-info");

    let tiradasDisponibles = 3;
    let enCooldown = false;
    let ruletaGirando = false;

    function actualizarTiradasUI() {
      tiradasInfoEl.textContent = `Tiradas disponibles hoy: ${tiradasDisponibles}`;
    }
    actualizarTiradasUI();

    function simularResultado(angle) {
      // 8 segmentos (45¬∞ cada uno)
      const adjusted = (360 - (angle % 360)) % 360;
      const segment = Math.floor(adjusted / 45); // 0..7
      const resultados = [
        "Ganaste 100 Lightning ‚ö°",
        "Ganaste 50 saldo libre üí∏",
        "Cup√≥n 30% descuento üéâ",
        "Ganaste 150 Lightning ‚ö°",
        "Ganaste 80 saldo libre üí∏",
        "Cup√≥n 20% descuento üéâ",
        "Sin premio, pero sum√°s chance para la TV üì∫",
        "Ganaste 50 Lightning ‚ö°"
      ];
      return resultados[segment] || "Premio misterioso üëÄ";
    }

    btnGirarEl.addEventListener("click", () => {
      if (ruletaGirando || enCooldown) return;

      if (tiradasDisponibles <= 0) {
        cooldownInfoEl.textContent = "Ya usaste todas las tiradas de hoy.";
        return;
      }

      ruletaGirando = true;
      btnGirarEl.disabled = true;
      resultadoEl.textContent = "";

      const vueltas = 6;
      const destino = Math.random() * 360;
      const totalAngle = vueltas * 360 + destino;

      ruletaEl.style.transition = "transform 3.2s cubic-bezier(0.2, 0.9, 0.25, 1)";
      ruletaEl.style.transform  = `rotate(${totalAngle}deg)`;

      setTimeout(() => {
        ruletaGirando = false;
        btnGirarEl.disabled = false;
        tiradasDisponibles -= 1;
        actualizarTiradasUI();

        const mensaje = simularResultado(destino);
        resultadoEl.textContent = mensaje;

        if (tiradasDisponibles <= 0) {
          enCooldown = true;
          cooldownInfoEl.textContent = "Ma√±ana vas a tener nuevas tiradas.";
        }
      }, 3300);
    });

    // CATEGOR√çAS - clics

    document.addEventListener("click", function(e) {
      const cat = e.target.closest(".categoria");
      if (!cat) return;

      const type = cat.getAttribute("data-cat");
      const labels = {
        muebles: "Muebles y hogar",
        deportes: "Deportes y fitness",
        comida: "Comida",
        electro: "Electrodom√©sticos",
        celulares: "Celulares"
      };

      if (type === "celulares") {
        goToCellphones();
      } else {
        loadCategoryFromFirestore(type, labels[type] || "Categor√≠a");
      }
    });

    // FIRESTORE: cargar publicaciones de categor√≠a

    async function loadCategoryFromFirestore(catKey, catLabel) {
      showScreen("category-screen");

      const titleEl = document.getElementById("category-title");
      const subEl   = document.getElementById("category-subtitle");
      const grid    = document.getElementById("category-grid");

      titleEl.textContent = catLabel;
      subEl.textContent   = "Ofertas en " + catLabel + " cargadas desde el panel admin.";
      grid.innerHTML      = "<p>Cargando publicaciones...</p>";

      try {
        const snap = await db
          .collection("publicaciones")
          .where("categoria", "==", catKey)
          .orderBy("creadoEn", "desc")
          .get();

        if (snap.empty) {
          grid.innerHTML = "<p style='padding:8px;'>Todav√≠a no hay publicaciones para esta categor√≠a.</p>";
          return;
        }

        grid.innerHTML = "";

        snap.forEach(doc => {
          const d = doc.data();

          const card = document.createElement("div");
          card.className = "cell-card";

          const precioAntes = d.precioAntes != null
            ? d.precioAntes.toLocaleString("es-UY")
            : null;
          const precioDesp  = d.precioDespues != null
            ? d.precioDespues.toLocaleString("es-UY")
            : null;

          card.innerHTML = `
            <div class="cell-img-wrap">
              <img src="${d.fotoUrl || "https://via.placeholder.com/200x200?text=Comodity"}" alt="${d.nombre || ""}">
            </div>
            <div class="cell-body">
              <div class="cell-name">${d.nombre || ""}</div>
              <div class="cell-prices">
                ${precioAntes ? `<div class="cell-price-old">$${precioAntes}</div>` : ""}
                ${precioDesp  ? `<div class="cell-price-now">$${precioDesp}</div>` : ""}
              </div>
              <div class="cell-discount-pill">
                <span>üî•</span>
                <span>${d.vendedor || "Comercio asociado"}</span>
              </div>
              <div class="cell-timer">
                Restan aprox. ${d.horasRestantes || 24} h
              </div>
            </div>
          `;

          card.addEventListener("click", () => {
            openCategoryDetail(d);
          });

          grid.appendChild(card);
        });

      } catch (err) {
        console.error(err);
        grid.innerHTML = "<p style='padding:8px;'>Error al cargar publicaciones.</p>";
      }
    }

    function openCategoryDetail(d) {
      const overlay = document.getElementById("cell-detail-overlay");
      const tEl     = document.getElementById("cell-detail-title");
      const imgEl   = document.getElementById("cell-detail-img");
      const pricesEl= document.getElementById("cell-detail-prices");
      const extraEl = document.getElementById("cell-detail-extra");

      tEl.textContent = d.nombre || "";
      imgEl.src = d.fotoUrl || "https://via.placeholder.com/400x300?text=Comodity";

      const precioAntes = d.precioAntes != null
        ? d.precioAntes.toLocaleString("es-UY")
        : null;
      const precioDesp  = d.precioDespues != null
        ? d.precioDespues.toLocaleString("es-UY")
        : null;

      pricesEl.innerHTML = `
        ${precioDesp ? `<div><strong>Precio actual:</strong> $${precioDesp}</div>` : ""}
        ${precioAntes ? `<div>Antes: <span style="text-decoration:line-through;color:#888;">$${precioAntes}</span></div>` : ""}
      `;

      extraEl.innerHTML = `
        <div><strong>Vendedor:</strong> ${d.vendedor || "Comercio asociado"}</div>
        <div><strong>Descripci√≥n:</strong> ${d.descripcion || "Oferta especial de Comodity."}</div>
        <div><strong>Duraci√≥n:</strong> Aproximadamente ${d.horasRestantes || 24} horas desde su publicaci√≥n.</div>
      `;

      overlay.style.display = "flex";
    }

    function closeCellDetail() {
      document.getElementById("cell-detail-overlay").style.display = "none";
    }

    // POPUPS cupones, lightning, perfil

    const couponsOverlay   = document.getElementById("coupons-overlay");
    const couponsListEl    = document.getElementById("coupons-list");
    const openCouponsBadge = document.getElementById("open-coupons");

    openCouponsBadge.addEventListener("click", () => {
      couponsListEl.innerHTML = `
        <div class="coupon-item">
          <div class="coupon-logo">PZ</div>
          <div class="coupon-text">
            <div class="coupon-brand">PizzaRocket</div>
            <div class="coupon-desc">25% OFF en local o delivery.</div>
          </div>
        </div>
        <div class="coupon-item">
          <div class="coupon-logo">MB</div>
          <div class="coupon-text">
            <div class="coupon-brand">MuebleBox</div>
            <div class="coupon-desc">10% OFF en muebles seleccionados.</div>
          </div>
        </div>
      `;
      couponsOverlay.style.display = "flex";
    });

    function closeCoupons() {
      couponsOverlay.style.display = "none";
    }

    const lightningOverlay = document.getElementById("lightning-overlay");
    document.getElementById("open-lightning").addEventListener("click", () => {
      lightningOverlay.style.display = "flex";
    });

    function closeLightning() {
      lightningOverlay.style.display = "none";
    }

    const profileOverlay = document.getElementById("profile-overlay");
    openProfileBtn.addEventListener("click", () => {
      profileOverlay.style.display = "flex";
      userMenuEl.style.display = "none";
    });

    function closeProfile() {
      profileOverlay.style.display = "none";
    }

    // Exponer funciones que se usan en onclicks del HTML
    window.goToHome          = goToHome;
    window.goToCellphones    = goToCellphones;
    window.closeCellDetail   = closeCellDetail;
    window.closeCoupons      = closeCoupons;
    window.closeLightning    = closeLightning;
    window.closeProfile      = closeProfile;
  </script>
</body>
</html>
