<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Admin Comodity</title>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    // Misma config que en tu index
    const firebaseConfig = {
      apiKey: "AIzaSyC7QcScbqc5dWL4WCatnemf_KGCaZtjCT4",
      authDomain: "comodity-9a7be.firebaseapp.com",
      projectId: "comodity-9a7be",
      storageBucket: "comodity-9a7be.firebasestorage.app",
      messagingSenderId: "560121634288",
      appId: "1:560121634288:web:e02bdad21bd4ee06255135",
      measurementId: "G-PYNZCB10T0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const ADMIN_EMAIL = "javier.araujo995@gmail.com";

    window.addEventListener("load", () => {
      const loadingEl     = document.getElementById("admin-loading");
      const noAccessEl    = document.getElementById("admin-no-access");
      const contentEl     = document.getElementById("admin-content");
      const userEmailSpan = document.getElementById("admin-user-email");

      auth.onAuthStateChanged(user => {
        loadingEl.style.display = "none";

        if (!user) {
          // ❌ No logueado: NO redirigimos automáticamente, solo mostramos mensaje
          noAccessEl.style.display = "block";
          noAccessEl.innerHTML = `
            No estás logueado.<br>
            <a href="index.html">Volver a Comodity</a>
          `;
          contentEl.style.display = "none";
          return;
        }

        if (user.email !== ADMIN_EMAIL) {
          // ❌ Logueado pero no admin
          noAccessEl.style.display = "block";
          noAccessEl.innerHTML = `
            No tenés permisos para ver esta página.<br>
            <a href="index.html">Volver a Comodity</a>
          `;
          contentEl.style.display = "none";
          return;
        }

        // ✅ Es el admin
        userEmailSpan.textContent = user.email;
        noAccessEl.style.display = "none";
        contentEl.style.display = "block";
      });
    });

    async function adminLogout() {
      try {
        await auth.signOut();
        window.location.href = "index.html";
      } catch (e) {
        console.error(e);
        alert("Error al cerrar sesión: " + e.message);
      }
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background:#f5f5f5;
      color:#222;
    }
    .admin-header {
      background:#f44336;
      color:#fff;
      padding:12px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .admin-title {
      font-size:18px;
      font-weight:bold;
    }
    .admin-main {
      max-width:900px;
      margin:20px auto;
      background:#fff;
      border-radius:12px;
      padding:16px 18px;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
    }
    .btn {
      padding:6px 12px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:13px;
      font-weight:bold;
    }
    .btn-logout {
      background:#fff;
      color:#f44336;
    }
    .small {
      font-size:13px;
      color:#555;
    }
    label {
      display:block;
      margin:8px 0 4px;
      font-size:13px;
    }
    input, textarea {
      width:100%;
      padding:6px 8px;
      font-size:13px;
      border-radius:8px;
      border:1px solid #ccc;
      box-sizing:border-box;
    }
    textarea {
      resize:vertical;
      min-height:60px;
    }
  </style>
</head>
<body>

  <header class="admin-header">
    <div class="admin-title">Panel Admin – Comodity</div>
    <div class="small">
      <span id="admin-user-email"></span>
      &nbsp;|&nbsp;
      <button class="btn btn-logout" onclick="adminLogout()">Cerrar sesión</button>
    </div>
  </header>

  <div id="admin-loading" class="admin-main">
    Verificando sesión...
  </div>

  <div id="admin-no-access" class="admin-main" style="display:none;"></div>

  <div id="admin-content" class="admin-main" style="display:none;">
    <h2>Configurar promociones / premios</h2>
    <p class="small">
      Acá después podemos armar todo el CRUD de ofertas, probabilidad de premios, etc.
    </p>

    <form id="admin-form">
      <label>Nombre de la promo</label>
      <input type="text" id="promo-name" placeholder="Ej: 30% en PizzaRocket" />

      <label>Descripción</label>
      <textarea id="promo-desc" placeholder="Detalle interno o texto que va a ver el usuario"></textarea>

      <label>Categoría</label>
      <input type="text" id="promo-category" placeholder="Ej: comida, electro, etc." />

      <label>Descuento / monto</label>
      <input type="text" id="promo-value" placeholder="Ej: 30% o $80" />

      <label>Probabilidad en ruleta (0 a 1)</label>
      <input type="number" step="0.01" min="0" max="1" id="promo-prob" value="0.10" />

      <button type="button" class="btn" style="margin-top:10px;background:#f44336;color:#fff;">
        Guardar (simulado)
      </button>
    </form>
  </div>

</body>
</html>
